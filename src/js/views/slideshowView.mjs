// import global not yet implemented for parcel 2
//import {logos} from '../../assets/images/logos/*';
// Need to import files individually

// Trails pictures 
// Lago di Fié - Malga Sessel
import lago_di_fie from 'url:../../assets/images/trails/Malga Sessel/lago_di_fie.jpg';
import lago_di_fie_camels from 'url:../../assets/images/trails/Malga Sessel/lago_di_fie_camels.jpg';
import sesselschwaige from 'url:../../assets/images/trails/Malga Sessel/sesselschwaige.jpg';

// Gruppo del Cevedale
import gruppo_del_cevedale_01 from 'url:../../assets/images/trails/Gruppo del Cevedale/gruppo_del_cevedale_01.jpg';
import lago_careser from 'url:../../assets/images/trails/Gruppo del Cevedale/lago_careser.jpg';
import lago_lungo from 'url:../../assets/images/trails/Gruppo del Cevedale/lago_lungo.jpg';
import lago_nero from 'url:../../assets/images/trails/Gruppo del Cevedale/lago_nero.jpg';

// Strada delle 54 gallerie del Pasubio
import cinquantadue_gallerie_del_pasubio_01 from 'url:../../assets/images/trails/Pasubio/cinquantadue_gallerie_del_pasubio_01.jpg';
import cinquantadue_gallerie_del_pasubio_02 from 'url:../../assets/images/trails/Pasubio/cinquantadue_gallerie_del_pasubio_02.jpg';
import cinquantadue_gallerie_del_pasubio_03 from 'url:../../assets/images/trails/Pasubio/cinquantadue_gallerie_del_pasubio_03.jpg';

// Giro dei cinque laghi
import cinque_laghi_01 from 'url:../../assets/images/trails/Giro dei cinque laghi/cinque_laghi_01.jpg';
import lago_ritorto_01 from 'url:../../assets/images/trails/Giro dei cinque laghi/lago_ritorto_01.jpg';
import lago_ritorto_02 from 'url:../../assets/images/trails/Giro dei cinque laghi/lago_ritorto_02.jpg';

// Monte Altissimo di Nago
import paraglider from 'url:../../assets/images/trails/Monte Altissimo di Nago/paraglider.jpg';
import garda_lake from 'url:../../assets/images/trails/Monte Altissimo di Nago/garda_lake.jpg';
import indicator from 'url:../../assets/images/trails/Monte Altissimo di Nago/indicator.jpg';

// Tre cime di Lavaredo
import tre_cime_lavaredo from 'url:../../assets/images/trails/Tre Cime di Lavaredo/tre_cime_lavaredo.jpg';
import sorapis from 'url:../../assets/images/trails/Tre Cime di Lavaredo/sorapis.jpg';
import tre_cime_di_lavaredo_panorama from 'url:../../assets/images/trails/Tre Cime di Lavaredo/panorama.jpg';

// Val di Genova
import val_di_genova_01 from 'url:../../assets/images/trails/Val di Genova/val_di_genova_01.jpg';
import val_di_genova_02 from 'url:../../assets/images/trails/Val di Genova/val_di_genova_02.jpg';
import val_di_genova_03 from 'url:../../assets/images/trails/Val di Genova/val_di_genova_03.jpg';

// Val di Fumo
import val_di_fumo_horses from 'url:../../assets/images/trails/Val di Fumo/val_di_fumo_horses.jpg';
import val_di_fumo_waterfall from 'url:../../assets/images/trails/Val di Fumo/val_di_fumo_waterfall.jpg';
import val_di_fumo_gate from 'url:../../assets/images/trails/Val di Fumo/val_di_fumo_gate.jpg';
import val_di_fumo_trunk from 'url:../../assets/images/trails/Val di Fumo/val_di_fumo_trunk.jpg';

// Travels pictures

// Cuba
// Havana
import plaza_vieja from 'url:../../assets/images/travels/Cuba/Havana/plaza_vieja.jpg';
import museo_de_la_revolucion from 'url:../../assets/images/travels/Cuba/Havana/museo_de_la_revolucion.jpg';
import havana_taxi from 'url:../../assets/images/travels/Cuba/Havana/havana_taxi.jpg';

// Cayo Largo
import cayo_largo_01 from 'url:../../assets/images/travels/Cuba/Cayo Largo/Cayo_Largo_01.jpg';
import cayo_largo_02 from 'url:../../assets/images/travels/Cuba/Cayo Largo/Cayo_Largo_02.jpg';
import cayo_largo_03 from 'url:../../assets/images/travels/Cuba/Cayo Largo/Cayo_Largo_03.jpg';

// Varadero
import varadero_01 from 'url:../../assets/images/travels/Cuba/Varadero/Varadero_01.jpg';
import varadero_02 from 'url:../../assets/images/travels/Cuba/Varadero/Varadero_02.jpg';
import varadero_03 from 'url:../../assets/images/travels/Cuba/Varadero/Varadero_03.jpg';

// Italy
// Cinque Terre
import cinque_terre_manarola from 'url:../../assets/images/travels/Italy/Cinque Terre/cinque_terre_manarola.jpg';
import cinque_terre_water from 'url:../../assets/images/travels/Italy/Cinque Terre/cinque_terre_water.jpg';
import cinque_terre_panorama from 'url:../../assets/images/travels/Italy/Cinque Terre/cinque_terre_panorama.jpg';

// La Spezia
import porto_venere_chiesa_san_pietro from 'url:../../assets/images/travels/Italy/La Spezia/porto_venere_chiesa_san_pietro.jpg';
import la_spezia_cliffs from 'url:../../assets/images/travels/Italy/La Spezia/la_spezia_cliffs.jpg';
import porto_venere_doria_castle from 'url:../../assets/images/travels/Italy/La Spezia/porto_venere_doria_castle.jpg';

// Merano
import merano_01 from 'url:../../assets/images/travels/Italy/Merano/merano_01.jpg';
import merano_02 from 'url:../../assets/images/travels/Italy/Merano/merano_02.jpg';
import trauttmansdorff_castle from 'url:../../assets/images/travels/Italy/Merano/trauttmansdorff_castle.jpg';

// Rome
import rome_vittoriano from 'url:../../assets/images/travels/Italy/Rome/rome_vittoriano.jpg';
import rome_colosseum from 'url:../../assets/images/travels/Italy/Rome/rome_colosseum.jpg';

// Russia
// Moscow
import saint_basil_01 from 'url:../../assets/images/travels/Russia/Moscow/saint_basil_01.jpg';
import saint_basil_02 from 'url:../../assets/images/travels/Russia/Moscow/saint_basil_02.jpg';
import christ_the_savior_cathedral from 'url:../../assets/images/travels/Russia/Moscow/christ_the_savior_cathedral.jpg';
import moscow_skyline from 'url:../../assets/images/travels/Russia/Moscow/moscow_skyline.jpg';

// Saint Petersburg
import hermitage_museum from 'url:../../assets/images/travels/Russia/Saint Petersburg/hermitage_museum.jpg';
import peterhoff_palace_01 from 'url:../../assets/images/travels/Russia/Saint Petersburg/peterhoff_palace_01.jpg';
import peterhoff_palace_02 from 'url:../../assets/images/travels/Russia/Saint Petersburg/peterhoff_palace_02.jpg';
import sailing_down_the_neva from 'url:../../assets/images/travels/Russia/Saint Petersburg/sailing_down_the_neva.jpg';

// Scotland
// Edinburgh
import st_giles_cathedral from 'url:../../assets/images/travels/Scotland/Edinburgh/st_giles_cathedral.jpg';
import nelson_monument from 'url:../../assets/images/travels/Scotland/Edinburgh/nelson_monument.jpg';
import edinburgh_castle from 'url:../../assets/images/travels/Scotland/Edinburgh/edinburgh_castle.jpg';

// Spain
// Seville
import plaza_de_espana_01 from 'url:../../assets/images/travels/Spain/Seville/plaza_de_espana_01.jpg';
import plaza_de_espana_02 from 'url:../../assets/images/travels/Spain/Seville/plaza_de_espana_02.jpg';
import plaza_de_espana_03 from 'url:../../assets/images/travels/Spain/Seville/plaza_de_espana_03.jpg';
import metropol_parasol_01 from 'url:../../assets/images/travels/Spain/Seville/metropol_parasol_01.jpg';
import cathedral_of_saint_mary_of_the_see_01 from 'url:../../assets/images/travels/Spain/Seville/cathedral_of_saint_mary_of_the_see_01.jpg';



// Certificates images

// Languages

// French

// English
import preview_english_uic from 'url:../../assets/images/certificates-previews/languages/english/UIC_languages_for_living.jpg';

// German

// Russian
import preview_russian_made_easy from 'url:../../assets/images/certificates-previews/languages/russian/Russian_Made_Easy_Accelerated_Learning_for_Russian.jpg';

// Spanish


// Front-end
// javascript
import preview_MITxPRO_Web_Development_with_JavaScript from 'url:../../assets/images/certificates-previews/front-end/javascript/MITxPRO_Web_Development_with_JavaScript.jpg';
import preview_the_complete_javaScript_course_2021 from 'url:../../assets/images/certificates-previews/front-end/javascript/The_complete_javaScript_course_2021.jpg';
import JavaScript_2019_JavaScript_ES6_Certification_Course from 'url:../../assets/images/certificates-previews/front-end/javascript/JavaScript_2019_JavaScript_ES6_Certification_Course.jpg';
import preview_functional_light_javascript_for_production from 'url:../../assets/images/certificates-previews/front-end/javascript/Functional_light_javascript_for_production.jpg';
// angular
import preview_reactive_angular_with_rxjs from 'url:../../assets/images/certificates-previews/front-end/angular/Reactive_angular_with_rxjs.jpg';

// react
import preview_mini_corso_su_react_e_typescript_2020 from 'url:../../assets/images/certificates-previews/front-end/react/Mini_corso_su_react_e_typescript_2020.jpg';

// Back-end
// c

// c++

// c#
import preview_csharp_for_beginners_foundamentals from 'url:../../assets/images/certificates-previews/back-end/Csharp_for_beginners_foundamentals.jpg';
import preview_csharp_intermediate_classes_interfaces_OOP from 'url:../../assets/images/certificates-previews/back-end/Csharp_intermediate_classes_interfaces_OOP.jpg';
import preview_double_your_coding_speed_with_visual_studio from 'url:../../assets/images/certificates-previews/back-end/Double_your_coding_speed_with_visual_studio.jpg';

 // 3D Modeling
 // blender



const fullView = {
    // TRAILS 
    // Lago di Fié - Malga Sessel
    lago_di_fie,
    lago_di_fie_camels,
    sesselschwaige,

    // Gruppo del Cevedale
    gruppo_del_cevedale_01,
    lago_careser,
    lago_lungo,
    lago_nero,

    // Strada delle 54 gallerie del Pasubio
    cinquantadue_gallerie_del_pasubio_01,
    cinquantadue_gallerie_del_pasubio_02,
    cinquantadue_gallerie_del_pasubio_03,

    // Giro dei cinque laghi
    cinque_laghi_01,
    lago_ritorto_01,
    lago_ritorto_02,

    // Monte Altissimo di Nago
    paraglider,
    garda_lake,
    indicator,

    // Tre cime di Lavaredo
    tre_cime_lavaredo,
    sorapis,
    tre_cime_di_lavaredo_panorama,

    // Val di Genova
    val_di_genova_01,
    val_di_genova_02,
    val_di_genova_03,

    // Val di Fumo
    val_di_fumo_horses,
    val_di_fumo_waterfall,
    val_di_fumo_gate,
    val_di_fumo_trunk,

    


    // TRAVELS

    // Cuba
    // Havana
    plaza_vieja,
    museo_de_la_revolucion,
    havana_taxi,

    // Cayo Largo
    cayo_largo_01,
    cayo_largo_02,
    cayo_largo_03,

    // Varadero
    varadero_01,
    varadero_02,
    varadero_03,

    // Italy

    // Cinque Terre
    cinque_terre_manarola,
    cinque_terre_water,
    cinque_terre_panorama,

    // La Spezia
    porto_venere_chiesa_san_pietro,
    la_spezia_cliffs,
    porto_venere_doria_castle,

    // Merano
    merano_01,
    merano_02,
    trauttmansdorff_castle,

    // Rome
    rome_vittoriano,
    rome_colosseum,

    // Russia
    // Moscow
    saint_basil_01,
    saint_basil_02,
    christ_the_savior_cathedral,
    moscow_skyline,

    // Saint_Petersburg
    hermitage_museum,
    peterhoff_palace_01,
    peterhoff_palace_02,
    sailing_down_the_neva,

    // Scotland
    // Edinburgh
    st_giles_cathedral,
    nelson_monument,
    edinburgh_castle,

    // Spain
    // Seville
    plaza_de_espana_01,
    plaza_de_espana_02,
    plaza_de_espana_03,
    metropol_parasol_01,
    cathedral_of_saint_mary_of_the_see_01,


    // Languages

    // French

    // English
    preview_english_uic,
    
    // German

    // Italian

    // Russian
    preview_russian_made_easy,

    // Spanish

    // Front-end
    // javascript
    preview_MITxPRO_Web_Development_with_JavaScript,
    preview_the_complete_javaScript_course_2021,
    JavaScript_2019_JavaScript_ES6_Certification_Course,
    preview_functional_light_javascript_for_production,
    
    // angular
    preview_reactive_angular_with_rxjs,

    // react
    preview_mini_corso_su_react_e_typescript_2020,

    // Back-end
    // c

    // c++

    // c#
    preview_csharp_for_beginners_foundamentals,
    preview_csharp_intermediate_classes_interfaces_OOP,
    preview_double_your_coding_speed_with_visual_studio,

    // 3D Modeling
    // blender  
}

class SlideshowView {
    _parentElement = document.querySelector('.app-container .window-container');
    _mainSectionElement = document.querySelector('.main-section');
    _data;

    constructor() {
        this._keyboardArrowsHandlerHandler = this._setKeyboardArrowsHandler.bind(this);
    }

    render(data) {
        this._data = data;

        const markup = this._generateMarkup();
        this._clear();
        this._parentElement.insertAdjacentHTML('beforeend', markup);
        this._openSlideshowView();

        this._setViewEventHandlers();
        this._showSlide(this._getCurrentSlideId());
    }

    _clear() {
        this._parentElement.innerHTML = '';
    }

    renderSpinner = function() {
        const markup = ``;
    }

    _generateMarkup() {
        return `
            <div class="window">
                <div class="header">
                    <span class="title">
                    </span>
                    <button class="close-window-button raised">x</button>
                </div>
                <div class="body sunk">
                    <div class="window-content fit">
                        <div class="slideshow-container fit">
                            <div class="slideshow fit">
                                ${this._data.length === 1 ?
                                    '' : 
                                    `
                                    <button 
                                        class="prev" 
                                        data-id="prev"
                                        title="Previous slide">
                                        &#10094;
                                    </button>
                                    `
                                }
                                <div class="images-container fit">
                                    ${this._data.map(
                                        image => this._generateImageMarkup(image)
                                    ).join('')}
                                </div>
                                ${this._data.length === 1 ?
                                    '' : 
                                    `
                                    <button 
                                        class="next" 
                                        data-id="next"
                                        title="Next slide">
                                        &#10095;
                                    </button>
                                    `
                                }
                            </div>
                            <div class="dots-container">
                                ${this._data.length === 1 ?
                                    ''
                                    :
                                    `
                                    ${this._data.map(
                                        image => this._generateDotMarkup(image)
                                    ).join('')}
                                    `
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer">
                    <button class="back raised" title="Back">Back</button>
                </div>
            </div>
        `;
    }

    _generateImageMarkup(image) {
        return `
        <div 
            class="mySlides fit hidden" 
            data-id="${image.id}">
            ${this._data.length === 1 ?
                ''
                :
                `
                <div class="numbertext">
                    ${this._data.findIndex(el => el.id === image.id) + 1} / ${this._data.length}
                </div>
                `
            }
            <img 
                class="slideshow-image" 
                alt="'${image.text}' full view"
                src="${fullView[image.preview]}" />
            <div class="text">
                ${image.description}
            </div>
        </div>
        `;
    }

    _generateDotMarkup(image) {
        return `
        <button 
            class="dot" 
            data-id="${image.id}"
            title="${image.text}">
        </button>
        `;
    }

    _openSlideshowView() {
        this._mainSectionElement.classList.add('blurred');
        this._parentElement.classList.remove('hidden');
        this._parentElement.classList.add('semi-transparent-background');
    }

    _closeSlideshowView() {
        document
            .removeEventListener(
                'keydown',
                this._keyboardArrowsHandlerHandler
            );

        this._mainSectionElement.classList.remove('blurred');
        this._parentElement.classList.add('hidden');
        this._parentElement.classList.remove('semi-transparent-background');
    }

    _setViewEventHandlers() {
        // Close window by clicking top-right 'x', bottom-right 'back' or outside modal window
        this._parentElement.querySelector('.close-window-button').addEventListener('click', () => this._closeSlideshowView());
        this._parentElement.querySelector('.back').addEventListener('click', () => this._closeSlideshowView());
        this._parentElement.addEventListener('click', (e) => {
            let window = e.target.closest('.window');
            if(window) return;
            this._closeSlideshowView()}
        );
        
        // Dot click
        this._parentElement.querySelector('.dots-container')
            .addEventListener(
                'click', 
                (e) => {
                    const dotDOMElement = e.target.closest('.dot');
                    if(!dotDOMElement) return;

                    const dotID = dotDOMElement.dataset.id;
                    this._showSlide(dotID);
                }
            );

        // Previous slide click
        const previous = this._parentElement.querySelector('.prev');
        if(previous) {
            previous.addEventListener(
                'click', 
                () => this._showSlide(this._getPreviousSlideId())
            );
        }
            

        // Next slide click
        const next = this._parentElement.querySelector('.next');
        if(next) {
            next.addEventListener(
                'click', 
                () => this._showSlide(this._getNextSlideId())
            );
        }

        // Keyboard arrows
        if(next && previous) {
            document
            .addEventListener(
                'keydown',
                this._keyboardArrowsHandlerHandler
            );
        }
    }

    _setKeyboardArrowsHandler(e) {
        var code = e.key || e.code;
        // Left
        if (code === 'ArrowLeft') this._showSlide(this._getPreviousSlideId());
        
        // Right
        if (code === 'ArrowRight') this._showSlide(this._getNextSlideId());
    }

    _showSlide(id) {
        Object.values(this._parentElement.querySelectorAll('.mySlides'))
            .forEach(
                slide => {
                    if(slide.dataset.id === id) {
                        slide.classList.remove('hidden');
                        // set header title <-- TO DO
                    } else {
                        slide.classList.add('hidden');
                    }
                });

        Object.values(this._parentElement.querySelectorAll('.dots-container .dot'))
                .forEach(
                    dot => 
                    dot.dataset.id === id ? 
                        dot.classList.add('selected') : 
                        dot.classList.remove('selected')
                    );
    }

    _getCurrentSlideId() {
        let currentlyShownSlideIndex = this._getCurrentlyShownSlideIndex();

        return this._data[currentlyShownSlideIndex].id;
    }

    _getPreviousSlideId() {
        const currentlyShownSlideIndex = this._getCurrentlyShownSlideIndex();

        let previousSlideIndex = 0;
        if(currentlyShownSlideIndex === 0) previousSlideIndex = this._data.length -1;
        if(currentlyShownSlideIndex !== 0) previousSlideIndex = currentlyShownSlideIndex -1;
            
        return this._data[previousSlideIndex].id;
    }

    _getNextSlideId() {
        const currentlyShownSlideIndex = this._getCurrentlyShownSlideIndex();

        let nextSlideIndex = 0;
        if(currentlyShownSlideIndex === this._data.length -1) nextSlideIndex = 0;
        if(currentlyShownSlideIndex !== this._data.length -1) nextSlideIndex = currentlyShownSlideIndex + 1;
        
        return this._data[nextSlideIndex].id;
    }

    _getCurrentlyShownSlideIndex() {
        let index = Object.values(this._parentElement.querySelectorAll('.mySlides'))
            .findIndex(slide => !slide.classList.contains('hidden'));

        // If no image is shown yet, teììreturn index 0.
        if(!index || index === -1) index = 0;

        return index;
    }
}

export default new SlideshowView();